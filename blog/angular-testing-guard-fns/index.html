<!DOCTYPE html>
<html lang="en">
<head><meta charset="utf-8">
<title>Angular: Testing Guard Functions</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#4c7f7f">
<meta name="keywords" content="Software Developer, Full-Stack Developer, Full-Stack, Paderborn">
<meta property="og:title" content="Alexander Friesen">
<meta name="og:title" content="Angular: Testing Guard Functions">
<meta name="og:url" content="http://localhost/blog/angular-testing-guard-fns">
<meta name="description" content="How to unit test Guard Functions in Angular.">
<meta name="og:description" content="How to unit test Guard Functions in Angular.">
<meta property="og:image" content="http://localhost/images/angular.svg">
<link rel="canonical" href="http://localhost/blog/angular-testing-guard-fns"><link rel="modulepreload" href="/blog/angular-testing-guard-fns/_payload.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/entry.a978b825.js"><link rel="preload" as="style" href="/_nuxt/entry.42a0cfe4.css"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/app.config.e22e55dc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/navigation.7d5a37c9.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_slug_.10c4b7e1.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentDoc.e14a0fe2.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/composables.a731ea37.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRenderer.4d92b08e.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentRendererMarkdown.0062bee4.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/_commonjsHelpers.0ee3bad0.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ContentQuery.7e9f0213.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/cookie.68f6ff19.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/query.c3f7607a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/utils.8fbade3a.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH2.0a26ebfc.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseP.b7fbe56d.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseH3.9042f1f6.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCode.9467698b.js"><link rel="modulepreload" as="script" crossorigin href="/_nuxt/ProseCodeInline.f574de59.js"><link rel="prefetch" as="script" crossorigin href="/_nuxt/error-component.2eaf51ea.js"><link rel="stylesheet" href="/_nuxt/entry.42a0cfe4.css"><style>.icon[data-v-07e34052]{display:inline-block;vertical-align:middle}</style><style>pre code .line{display:block;min-height:1rem}</style></head>
<body ><div id="__nuxt"><!--[--><header class="shadow"><nav data-headlessui-state class="bg-gray-800"><div class="max-w-7xl mx-auto px-2 sm:px-6 lg:px-8"><div class="relative flex items-center justify-between h-16"><div class="absolute inset-y-0 left-0 flex items-center sm:hidden"><button id="headlessui-disclosure-button-11" type="button" aria-expanded="false" data-headlessui-state class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"><span class="sr-only">Open main menu</span><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="icon block h-6 w-6" style="" width="1em" height="1em" viewBox="0 0 24 24" data-v-07e34052><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg></button></div><div class="flex-1 flex items-center justify-center sm:items-stretch sm:justify-start"><div class="flex-shrink-0 flex items-center"><h1 class="text-white">Alexander Friesen</h1></div><div class="hidden sm:flex sm:ml-6 flex-1 justify-between gap-4"><div class="flex gap-4"><!--[--><a href="/" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</a><a href="/projects" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Projects</a><a href="/blog" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Blog</a><!--]--></div><div class="flex gap-4"><!--[--><a href="/contact" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Contact</a><!--]--></div></div></div></div></div><!----></nav></header><main><!--[--><section class="max-w-7xl mx-auto px-2 py-6 sm:px-6 lg:px-8"><!--[--><!--[--><article class="prose prose-invert max-w-none"><h2 id="angular-testing-guard-functions"><a href="#angular-testing-guard-functions"><!--[-->Angular: Testing Guard Functions<!--]--></a></h2><p><!--[-->Recently the Angular Team added a new and handy way to define Route Guards in a functional way.<!--]--></p><h3 id="example-canactivatefn"><a href="#example-canactivatefn"><!--[-->Example CanActivateFn<!--]--></a></h3><p><!--[-->Here is a simple CanActivateFn example:<!--]--></p><!--[--><pre><code><span class="line"><span class="ct-2c0611">export</span><span class="ct-d35929"> </span><span class="ct-2c0611">const</span><span class="ct-d35929"> </span><span class="ct-32a1f9">authGuard</span><span class="ct-2c0611">:</span><span class="ct-d35929"> </span><span class="ct-dee862">CanActivateFn</span><span class="ct-d35929"> </span><span class="ct-2c0611">=</span><span class="ct-d35929"> (</span><span class="ct-dee862">route</span><span class="ct-d35929">, </span><span class="ct-dee862">state</span><span class="ct-d35929">) </span><span class="ct-2c0611">=&gt;</span><span class="ct-d35929"> {</span></span><span class="line"><span class="ct-d35929">    </span><span class="ct-2c0611">const</span><span class="ct-d35929"> </span><span class="ct-e624a0">auth</span><span class="ct-d35929"> </span><span class="ct-2c0611">=</span><span class="ct-d35929"> </span><span class="ct-32a1f9">inject</span><span class="ct-d35929">(AuthService);</span></span><span class="line"><span class="ct-d35929">    </span><span class="ct-2c0611">return</span><span class="ct-d35929"> auth.isLoggedIn;</span></span><span class="line"><span class="ct-d35929">};</span></span></code></pre><!--]--><h3 id="testing"><a href="#testing"><!--[-->Testing<!--]--></a></h3><p><!--[-->As you can see from the example above we are not dealing with an Injectable and need to run need a way to execute our Function within a DI Context.<!--]--></p><p><!--[-->Luckily we grab an <code><!--[-->EnvironmentInjector<!--]--></code> from <code><!--[-->TestBed<!--]--></code> to run our function with all our Providers.<!--]--></p><!--[--><pre><code><span class="line"><span class="ct-32a1f9">describe</span><span class="ct-d35929">(</span><span class="ct-0fca08">&#39;TourStausGuard&#39;</span><span class="ct-d35929">, () </span><span class="ct-2c0611">=&gt;</span><span class="ct-d35929"> {</span></span><span class="line"><span class="ct-d35929">    </span><span class="ct-32a1f9">beforeEach</span><span class="ct-d35929">(() </span><span class="ct-2c0611">=&gt;</span><span class="ct-d35929"> {</span></span><span class="line"><span class="ct-d35929">        TestBed.</span><span class="ct-32a1f9">configureTestingModule</span><span class="ct-d35929">({</span></span><span class="line"><span class="ct-d35929">            providers: [</span></span><span class="line"><span class="ct-d35929">                {</span></span><span class="line"><span class="ct-d35929">                    provide: AuthService,</span></span><span class="line"><span class="ct-d35929">                    useValue: { isLoggedIn: </span><span class="ct-e624a0">true</span><span class="ct-d35929"> },</span></span><span class="line"><span class="ct-d35929">                },</span></span><span class="line"><span class="ct-d35929">            ],</span></span><span class="line"><span class="ct-d35929">        });</span></span><span class="line"><span class="ct-d35929">    });</span></span><span class="line"></span><span class="line"><span class="ct-d35929">    </span><span class="ct-32a1f9">it</span><span class="ct-d35929">(</span><span class="ct-0fca08">&#39;should allow accessing active tours&#39;</span><span class="ct-d35929">, () </span><span class="ct-2c0611">=&gt;</span><span class="ct-d35929"> {</span></span><span class="line"><span class="ct-d35929">        </span><span class="ct-2c0611">const</span><span class="ct-d35929"> </span><span class="ct-e624a0">envInjector</span><span class="ct-d35929"> </span><span class="ct-2c0611">=</span><span class="ct-d35929"> TestBed.</span><span class="ct-32a1f9">inject</span><span class="ct-d35929">(EnvironmentInjector);</span></span><span class="line"><span class="ct-d35929">        envInjector.</span><span class="ct-32a1f9">runInContext</span><span class="ct-d35929">(() </span><span class="ct-2c0611">=&gt;</span><span class="ct-d35929"> {</span></span><span class="line"><span class="ct-d35929">            </span><span class="ct-32a1f9">expect</span><span class="ct-d35929">(</span><span class="ct-32a1f9">guard</span><span class="ct-d35929">(</span><span class="ct-e624a0">null</span><span class="ct-d35929">, </span><span class="ct-e624a0">null</span><span class="ct-d35929">)).</span><span class="ct-32a1f9">toBe</span><span class="ct-d35929">(</span><span class="ct-e624a0">true</span><span class="ct-d35929">);</span></span><span class="line"><span class="ct-d35929">        });</span></span><span class="line"><span class="ct-d35929">    });</span></span><span class="line"><span class="ct-d35929">});</span></span></code></pre><!--]--><style>.ct-0fca08{color:#A5D6FF}
.ct-e624a0{color:#79C0FF}
.ct-dee862{color:#FFA657}
.ct-32a1f9{color:#D2A8FF}
.ct-d35929{color:#C9D1D9}
.ct-2c0611{color:#FF7B72}</style></article><!--]--><!--]--></section><!--]--></main><footer><section class="max-w-7xl mx-auto px-2 py-6 sm:px-6 lg:px-8 text-center"><!--[--> © 2023 - Alexander Friesen <!--]--></section></footer><!--]--></div><script type="module">import p from "/blog/angular-testing-guard-fns/_payload.js";window.__NUXT__={...p,...((function(a,b,c,d){return {state:{$sicons:{"heroicons:bars-3":{left:b,top:b,width:d,height:d,rotate:b,vFlip:a,hFlip:a,body:"\u003Cpath fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5\"\u002F\u003E"}}},_errors:{},serverRendered:true,config:{public:{content:{locales:[],integrity:1674755708912,experimental:{stripQueryParameters:a,clientDB:a},api:{baseURL:"\u002Fapi\u002F_content"},navigation:{fields:[]},tags:{p:"prose-p",a:"prose-a",blockquote:"prose-blockquote","code-inline":"prose-code-inline",code:"prose-code",em:"prose-em",h1:"prose-h1",h2:"prose-h2",h3:"prose-h3",h4:"prose-h4",h5:"prose-h5",h6:"prose-h6",hr:"prose-hr",img:"prose-img",ul:"prose-ul",ol:"prose-ol",li:"prose-li",strong:"prose-strong",table:"prose-table",thead:"prose-thead",tbody:"prose-tbody",td:"prose-td",th:"prose-th",tr:"prose-tr"},highlight:{theme:"github-dark"},wsUrl:c,documentDriven:a,host:c,trailingSlash:a,anchorLinks:{depth:4,exclude:[1]}}},app:{baseURL:"\u002F",buildAssetsDir:"\u002F_nuxt\u002F",cdnURL:c}},prerenderedAt:1674755724046}}(false,0,"",24)))}</script><script type="module" src="/_nuxt/entry.a978b825.js" crossorigin></script><script type="module" src="/_nuxt/navigation.7d5a37c9.js" crossorigin></script><script type="module" src="/_nuxt/_slug_.10c4b7e1.js" crossorigin></script><script type="module" src="/_nuxt/ContentDoc.e14a0fe2.js" crossorigin></script><script type="module" src="/_nuxt/ContentRenderer.4d92b08e.js" crossorigin></script><script type="module" src="/_nuxt/ContentRendererMarkdown.0062bee4.js" crossorigin></script><script type="module" src="/_nuxt/ProseH2.0a26ebfc.js" crossorigin></script><script type="module" src="/_nuxt/ProseP.b7fbe56d.js" crossorigin></script><script type="module" src="/_nuxt/ProseH3.9042f1f6.js" crossorigin></script><script type="module" src="/_nuxt/ProseCode.9467698b.js" crossorigin></script><script type="module" src="/_nuxt/ProseCodeInline.f574de59.js" crossorigin></script></body>
</html>